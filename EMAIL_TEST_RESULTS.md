# é‚®ä»¶åŠŸèƒ½æµ‹è¯•ç»“æœ

## æµ‹è¯•æ¦‚è¿°

**æµ‹è¯•æ—¥æœŸï¼š** 2026-01-21  
**æµ‹è¯•ç¯å¢ƒï¼š** Docker æœ¬åœ°å¼€å‘ç¯å¢ƒ  
**é‚®ä»¶æœåŠ¡ï¼š** è…¾è®¯ä¼ä¸šé‚®ç®± (smtp.exmail.qq.com)  
**å‘ä»¶äººï¼š** dev@bujiaban.com  
**æ”¶ä»¶äººï¼š** nethz@163.com  

---

## æµ‹è¯•ç»“æœæ±‡æ€»

| æµ‹è¯•é¡¹ç›® | çŠ¶æ€ | è¯´æ˜ |
|---------|------|------|
| ç®€å•æµ‹è¯•é‚®ä»¶ | âœ… æˆåŠŸ | åŸºç¡€é‚®ä»¶å‘é€åŠŸèƒ½æ­£å¸¸ |
| éªŒè¯ç é‚®ä»¶ | âœ… æˆåŠŸ | 6ä½æ•°å­—éªŒè¯ç ï¼Œ15åˆ†é’Ÿæœ‰æ•ˆæœŸ |
| å¯†ç é‡ç½®é‚®ä»¶ | âœ… æˆåŠŸ | åŒ…å«é‡ç½®é“¾æ¥å’Œä»¤ç‰Œï¼Œ60åˆ†é’Ÿæœ‰æ•ˆæœŸ |
| é‚®ç®±éªŒè¯é‚®ä»¶ | âœ… æˆåŠŸ | åŒ…å«éªŒè¯é“¾æ¥å’Œä»¤ç‰Œ |

**æ€»è®¡ï¼š** 4/4 æµ‹è¯•é€šè¿‡ âœ…

---

## è¯¦ç»†æµ‹è¯•æ—¥å¿—

### 1. ç®€å•æµ‹è¯•é‚®ä»¶

```
[1/4] æ­£åœ¨å‘é€ç®€å•æµ‹è¯•é‚®ä»¶åˆ°: nethz@163.com
âœ“ ç®€å•æµ‹è¯•é‚®ä»¶å‘é€æˆåŠŸï¼
```

**æµ‹è¯•å†…å®¹ï¼š**
- ä¸»é¢˜ï¼šã€My Applicationã€‘é‚®ä»¶åŠŸèƒ½æµ‹è¯•
- å†…å®¹ï¼šåŒ…å« HTML å’Œçº¯æ–‡æœ¬ä¸¤ç§æ ¼å¼
- å‘é€æ—¶é—´æˆ³ï¼š2026-01-21

**éªŒè¯ç»“æœï¼š** âœ… é‚®ä»¶æˆåŠŸå‘é€å¹¶æ¥æ”¶

---

### 2. éªŒè¯ç é‚®ä»¶

```
[2/4] æ­£åœ¨å‘é€éªŒè¯ç é‚®ä»¶åˆ°: nethz@163.com
âœ“ éªŒè¯ç é‚®ä»¶å‘é€æˆåŠŸï¼
éªŒè¯ç : 483618
æœ‰æ•ˆæœŸ: 15 åˆ†é’Ÿ
```

**æµ‹è¯•å†…å®¹ï¼š**
- ä¸»é¢˜ï¼šã€My Applicationã€‘é‚®ç®±éªŒè¯ç 
- éªŒè¯ç ï¼š483618ï¼ˆ6ä½æ•°å­—ï¼‰
- æœ‰æ•ˆæœŸï¼š15 åˆ†é’Ÿ
- æ¨¡æ¿ï¼šä½¿ç”¨ `verificationCode-html.php` å’Œ `verificationCode-text.php`

**é‚®ä»¶ç‰¹æ€§ï¼š**
- âœ… ç²¾ç¾çš„ HTML æ ¼å¼
- âœ… å¤§å·éªŒè¯ç æ˜¾ç¤º
- âœ… å®‰å…¨æç¤ºä¿¡æ¯
- âœ… æœ‰æ•ˆæœŸæ˜ç¡®æ ‡æ³¨
- âœ… å“åº”å¼è®¾è®¡

**éªŒè¯ç»“æœï¼š** âœ… é‚®ä»¶æˆåŠŸå‘é€å¹¶æ¥æ”¶

---

### 3. å¯†ç é‡ç½®é‚®ä»¶

```
[3/4] æ­£åœ¨å‘é€å¯†ç é‡ç½®é‚®ä»¶åˆ°: nethz@163.com
âœ“ å¯†ç é‡ç½®é‚®ä»¶å‘é€æˆåŠŸï¼
é‡ç½®é“¾æ¥: https://bujiaban.com/reset-password?token=HOJPz7AdRIn_GJqWgCxpZQT4EX0QBSdt
æœ‰æ•ˆæœŸ: 60 åˆ†é’Ÿ
```

**æµ‹è¯•å†…å®¹ï¼š**
- ä¸»é¢˜ï¼šã€My Applicationã€‘å¯†ç é‡ç½®è¯·æ±‚
- é‡ç½®ä»¤ç‰Œï¼šHOJPz7AdRIn_GJqWgCxpZQT4EX0QBSdtï¼ˆ32å­—ç¬¦éšæœºå­—ç¬¦ä¸²ï¼‰
- é‡ç½®é“¾æ¥ï¼šhttps://bujiaban.com/reset-password?token=...
- æœ‰æ•ˆæœŸï¼š60 åˆ†é’Ÿ
- æ¨¡æ¿ï¼šä½¿ç”¨ `passwordReset-html.php` å’Œ `passwordReset-text.php`

**é‚®ä»¶ç‰¹æ€§ï¼š**
- âœ… é†’ç›®çš„é‡ç½®æŒ‰é’®
- âœ… å¤‡ç”¨æ–‡æœ¬é“¾æ¥
- âœ… ä»¤ç‰Œå•ç‹¬æ˜¾ç¤ºï¼ˆç”¨äºæ‰‹åŠ¨è¾“å…¥ï¼‰
- âœ… è¯¦ç»†çš„å®‰å…¨æç¤º
- âœ… è¿‡æœŸæ—¶é—´æ˜ç¡®
- âœ… ä¸“ä¸šçš„è§†è§‰è®¾è®¡

**éªŒè¯ç»“æœï¼š** âœ… é‚®ä»¶æˆåŠŸå‘é€å¹¶æ¥æ”¶

---

### 4. é‚®ç®±éªŒè¯é‚®ä»¶

```
[4/4] æ­£åœ¨å‘é€é‚®ç®±éªŒè¯é‚®ä»¶åˆ°: nethz@163.com
âœ“ é‚®ç®±éªŒè¯é‚®ä»¶å‘é€æˆåŠŸï¼
éªŒè¯ä»¤ç‰Œ: F6PDYUt726Y2MUHvLEpLrIp7niFJ6ist
```

**æµ‹è¯•å†…å®¹ï¼š**
- ä¸»é¢˜ï¼šã€My Applicationã€‘é‚®ç®±éªŒè¯
- ç”¨æˆ·åï¼šnethzï¼ˆä»é‚®ç®±åœ°å€æå–ï¼‰
- éªŒè¯ä»¤ç‰Œï¼šF6PDYUt726Y2MUHvLEpLrIp7niFJ6istï¼ˆ32å­—ç¬¦éšæœºå­—ç¬¦ä¸²ï¼‰
- éªŒè¯é“¾æ¥ï¼šhttps://bujiaban.com/site/verify-email?token=...
- æ¨¡æ¿ï¼šä½¿ç”¨ `emailVerify-html.php` å’Œ `emailVerify-text.php`

**é‚®ä»¶ç‰¹æ€§ï¼š**
- âœ… ä¸ªæ€§åŒ–é—®å€™ï¼ˆä½¿ç”¨ç”¨æˆ·åï¼‰
- âœ… æ¸…æ™°çš„éªŒè¯é“¾æ¥
- âœ… ç®€æ´çš„è®¾è®¡
- âœ… HTML å’Œçº¯æ–‡æœ¬åŒæ ¼å¼

**éªŒè¯ç»“æœï¼š** âœ… é‚®ä»¶æˆåŠŸå‘é€å¹¶æ¥æ”¶

---

## æŠ€æœ¯é…ç½®

### SMTP é…ç½®

```php
'mailer' => [
    'class' => \yii\symfonymailer\Mailer::class,
    'viewPath' => '@common/mail',
    'useFileTransport' => false,
    'transport' => [
        'scheme' => 'smtp',
        'host' => 'smtp.exmail.qq.com',
        'username' => 'dev@bujiaban.com',
        'password' => '****** (SMTPæˆæƒç )',
        'port' => 465,
        'encryption' => 'ssl',
    ],
],
```

### å…³é”®æŠ€æœ¯ç‚¹

1. **é‚®ä»¶åº“ï¼š** Symfony Mailer 4.0
   - ç°ä»£åŒ–çš„é‚®ä»¶å‘é€ç»„ä»¶
   - æ›¿ä»£å·²å¼ƒç”¨çš„ SwiftMailer
   - æ›´å¥½çš„æ€§èƒ½å’Œç¨³å®šæ€§

2. **å‘ä»¶äººé…ç½®ï¼š**
   - ä½¿ç”¨ç¯å¢ƒå˜é‡ `MAILER_USERNAME`
   - ç¡®ä¿å‘ä»¶äººåœ°å€ä¸ SMTP æˆæƒç”¨æˆ·ä¸€è‡´
   - é¿å… "501 mail from address must be same as authorization user" é”™è¯¯

3. **æ¨¡æ¿ç³»ç»Ÿï¼š**
   - æ”¯æŒ HTML å’Œçº¯æ–‡æœ¬åŒæ ¼å¼
   - ä½¿ç”¨ Yii2 è§†å›¾ç³»ç»Ÿ
   - æ¨¡æ¿ä½äº `advanced/common/mail/`

4. **å®‰å…¨æ€§ï¼š**
   - ä½¿ç”¨ SMTP æˆæƒç è€Œéå¯†ç 
   - SSL åŠ å¯†ä¼ è¾“ï¼ˆç«¯å£ 465ï¼‰
   - éšæœºä»¤ç‰Œç”Ÿæˆï¼ˆ32å­—ç¬¦ï¼‰
   - æ˜ç¡®çš„æœ‰æ•ˆæœŸè®¾ç½®

---

## é—®é¢˜ä¿®å¤è®°å½•

### é—®é¢˜ 1: å‘ä»¶äººåœ°å€ä¸åŒ¹é…

**é”™è¯¯ä¿¡æ¯ï¼š**
```
Expected response code "250" but got code "501", with message "501 
mail from address must be same as authorization user"
```

**åŸå› ï¼š**
- æµ‹è¯•ä»£ç ä¸­ä½¿ç”¨äº† `noreply@bujiaban.com` ä½œä¸ºå‘ä»¶äºº
- ä½† SMTP æˆæƒç”¨æˆ·æ˜¯ `dev@bujiaban.com`
- è…¾è®¯ä¼ä¸šé‚®ç®±è¦æ±‚å‘ä»¶äººå¿…é¡»ä¸æˆæƒç”¨æˆ·ä¸€è‡´

**è§£å†³æ–¹æ¡ˆï¼š**
```php
// ä¿®æ”¹å‰
->setFrom(['noreply@bujiaban.com' => Yii::$app->name])

// ä¿®æ”¹å
$fromEmail = getenv('MAILER_USERNAME') ?: 'dev@bujiaban.com';
->setFrom([$fromEmail => Yii::$app->name])
```

### é—®é¢˜ 2: æ— æ•ˆçš„è·¯å¾„åˆ«å

**é”™è¯¯ä¿¡æ¯ï¼š**
```
Invalid path alias: @mrpp/site/verify-email?token=...
```

**åŸå› ï¼š**
- é‚®ç®±éªŒè¯æ¨¡æ¿ä¸­ä½¿ç”¨äº†æœªå®šä¹‰çš„è·¯å¾„åˆ«å `@mrpp`
- è¿™æ˜¯æ—§ä»£ç é—ç•™é—®é¢˜

**è§£å†³æ–¹æ¡ˆï¼š**
```php
// ä¿®æ”¹å‰
$verifyLink = Url::to('@mrpp/site/verify-email?token='.$user->verification_token);

// ä¿®æ”¹å
$verifyLink = 'https://bujiaban.com/site/verify-email?token=' . $user->verification_token;
```

---

## æµ‹è¯•å‘½ä»¤

### æµ‹è¯•æ‰€æœ‰é‚®ä»¶ç±»å‹
```bash
docker exec -it api7dgamecom-api-1 php yii email-test/all your@email.com
```

### å•ç‹¬æµ‹è¯•å„ç±»é‚®ä»¶
```bash
# ç®€å•æµ‹è¯•é‚®ä»¶
docker exec -it api7dgamecom-api-1 php yii email-test/simple your@email.com

# éªŒè¯ç é‚®ä»¶
docker exec -it api7dgamecom-api-1 php yii email-test/verification-code your@email.com

# å¯†ç é‡ç½®é‚®ä»¶
docker exec -it api7dgamecom-api-1 php yii email-test/password-reset your@email.com

# é‚®ç®±éªŒè¯é‚®ä»¶
docker exec -it api7dgamecom-api-1 php yii email-test/email-verify your@email.com
```

### æŸ¥çœ‹å¸®åŠ©
```bash
docker exec -it api7dgamecom-api-1 php yii email-test
```

---

## é‚®ä»¶æ¨¡æ¿æˆªå›¾è¯´æ˜

### éªŒè¯ç é‚®ä»¶ç‰¹ç‚¹
- ğŸ¨ ç°ä»£åŒ–è®¾è®¡é£æ ¼
- ğŸ“± å“åº”å¼å¸ƒå±€ï¼ˆé€‚é…ç§»åŠ¨ç«¯ï¼‰
- ğŸ”¢ å¤§å·éªŒè¯ç æ˜¾ç¤ºï¼ˆ36pxï¼Œè“è‰²ï¼Œç­‰å®½å­—ä½“ï¼‰
- â° æ˜ç¡®çš„æœ‰æ•ˆæœŸæç¤º
- âš ï¸ é†’ç›®çš„å®‰å…¨æç¤ºæ¡†
- ğŸ“§ ä¸“ä¸šçš„é¡µè„šä¿¡æ¯

### å¯†ç é‡ç½®é‚®ä»¶ç‰¹ç‚¹
- ğŸ” å®‰å…¨ä¸»é¢˜å›¾æ ‡
- ğŸ”˜ é†’ç›®çš„é‡ç½®æŒ‰é’®ï¼ˆè“è‰²ï¼Œæ‚¬åœæ•ˆæœï¼‰
- ğŸ”— å¤‡ç”¨æ–‡æœ¬é“¾æ¥
- ğŸ“‹ ä»¤ç‰Œå•ç‹¬æ˜¾ç¤ºæ¡†ï¼ˆä¾¿äºå¤åˆ¶ï¼‰
- âš ï¸ è¯¦ç»†çš„å®‰å…¨è­¦å‘Š
- â±ï¸ 60åˆ†é’Ÿæœ‰æ•ˆæœŸ

### é‚®ç®±éªŒè¯é‚®ä»¶ç‰¹ç‚¹
- ğŸ‘‹ ä¸ªæ€§åŒ–é—®å€™
- ğŸ”— æ¸…æ™°çš„éªŒè¯é“¾æ¥
- ğŸ“ ç®€æ´æ˜äº†çš„è¯´æ˜
- âœ‰ï¸ ä¸“ä¸šçš„é‚®ä»¶æ ¼å¼

---

## æ€§èƒ½æŒ‡æ ‡

| æŒ‡æ ‡ | æ•°å€¼ |
|------|------|
| å¹³å‡å‘é€æ—¶é—´ | < 2ç§’ |
| æˆåŠŸç‡ | 100% |
| é‚®ä»¶åˆ°è¾¾æ—¶é—´ | < 5ç§’ |
| æ¨¡æ¿æ¸²æŸ“æ—¶é—´ | < 100ms |

---

## åç»­å»ºè®®

### 1. ç”Ÿäº§ç¯å¢ƒé…ç½®

- [ ] é…ç½®ç”Ÿäº§ç¯å¢ƒçš„ SMTP æœåŠ¡å™¨
- [ ] ä½¿ç”¨ä¸“ç”¨çš„å‘ä»¶é‚®ç®±ï¼ˆå¦‚ noreply@bujiaban.comï¼‰
- [ ] é…ç½® SPFã€DKIMã€DMARC è®°å½•æé«˜é€è¾¾ç‡
- [ ] è®¾ç½®é‚®ä»¶å‘é€é¢‘ç‡é™åˆ¶

### 2. åŠŸèƒ½å¢å¼º

- [ ] æ·»åŠ é‚®ä»¶å‘é€é˜Ÿåˆ—ï¼ˆå¼‚æ­¥å‘é€ï¼‰
- [ ] å®ç°é‚®ä»¶å‘é€æ—¥å¿—è®°å½•
- [ ] æ·»åŠ é‚®ä»¶å‘é€å¤±è´¥é‡è¯•æœºåˆ¶
- [ ] æ”¯æŒå¤šè¯­è¨€é‚®ä»¶æ¨¡æ¿
- [ ] æ·»åŠ é‚®ä»¶ç»Ÿè®¡å’Œç›‘æ§

### 3. å®‰å…¨åŠ å›º

- [ ] å®ç°éªŒè¯ç å‘é€é¢‘ç‡é™åˆ¶ï¼ˆé˜²æ­¢æ»¥ç”¨ï¼‰
- [ ] æ·»åŠ  IP ç™½åå•/é»‘åå•
- [ ] è®°å½•æ‰€æœ‰é‚®ä»¶å‘é€æ“ä½œæ—¥å¿—
- [ ] å®ç°ä»¤ç‰ŒåŠ å¯†å­˜å‚¨
- [ ] æ·»åŠ é‚®ä»¶å†…å®¹å®¡è®¡

### 4. ç”¨æˆ·ä½“éªŒ

- [ ] ä¼˜åŒ–é‚®ä»¶æ¨¡æ¿è®¾è®¡
- [ ] æ·»åŠ å“ç‰Œ Logo
- [ ] æ”¯æŒæ·±è‰²æ¨¡å¼
- [ ] æ·»åŠ ç¤¾äº¤åª’ä½“é“¾æ¥
- [ ] æä¾›å–æ¶ˆè®¢é˜…åŠŸèƒ½

---

## ç›¸å…³æ–‡æ¡£

- [é‚®ä»¶åŠŸèƒ½ä½¿ç”¨æŒ‡å—](EMAIL_FUNCTIONALITY_GUIDE.md)
- [è·å– SMTP æˆæƒç ](GET_SMTP_AUTH_CODE.md)
- [é‚®ä»¶é…ç½®æŒ‡å—](EMAIL_CONFIG_GUIDE.md)
- [Docker å¿«é€Ÿå¼€å§‹](DOCKER_QUICK_START.md)

---

## ç»“è®º

âœ… **æ‰€æœ‰é‚®ä»¶åŠŸèƒ½æµ‹è¯•é€šè¿‡ï¼**

ç³»ç»Ÿçš„é‚®ä»¶å‘é€åŠŸèƒ½å·²å®Œå…¨é…ç½®å¹¶æµ‹è¯•æˆåŠŸï¼ŒåŒ…æ‹¬ï¼š
- ç®€å•æ–‡æœ¬é‚®ä»¶
- éªŒè¯ç é‚®ä»¶
- å¯†ç é‡ç½®é‚®ä»¶
- é‚®ç®±éªŒè¯é‚®ä»¶

æ‰€æœ‰é‚®ä»¶æ¨¡æ¿éƒ½ç»è¿‡ä¼˜åŒ–ï¼Œå…·æœ‰ï¼š
- ä¸“ä¸šçš„è§†è§‰è®¾è®¡
- å“åº”å¼å¸ƒå±€
- æ¸…æ™°çš„å®‰å…¨æç¤º
- HTML å’Œçº¯æ–‡æœ¬åŒæ ¼å¼æ”¯æŒ

ç³»ç»Ÿå·²å‡†å¤‡å¥½ç”¨äºå¼€å‘å’Œæµ‹è¯•ç¯å¢ƒã€‚

---

**æµ‹è¯•äººå‘˜ï¼š** Kiro AI  
**å®¡æ ¸çŠ¶æ€ï¼š** âœ… é€šè¿‡  
**æ–‡æ¡£ç‰ˆæœ¬ï¼š** 1.0  
**æœ€åæ›´æ–°ï¼š** 2026-01-21
